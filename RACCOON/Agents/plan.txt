### Chain of Thought (COT)

To address the task of evaluating the financial performance of BTG's key product lines over the last two years, with a focus on identifying segments that have experienced significant revenue declines or margins, we will break down this primary task into several focused sub-tasks. Each sub-task will address a specific aspect of the financial analysis, leveraging different financial data tools and insights. 

1. **Identify Key Financial Statements:** The first step involves identifying and retrieving BTG's income statement, balance sheet, and cash flow statement over the last two years. This provides a comprehensive picture of the financial health of BTG and is essential for further analysis.

2. **Analyze Revenue Streams:** Once we have the necessary financial data, the next step will involve breaking down revenue by product lines. This analysis will help identify which specific segments are declining in revenue and will require extracting detailed income statement data.

3. **Assess Margin Trends:** After analyzing revenue, the following task will be to assess margin trends for the identified product lines, which will rely on the results from the previous analysis of revenue. This involves calculating margins based on revenue and relevant costs from the income statement.

4. **Compile Results and Identify Key Findings:** Finally, findings from the previous tasks will be compiled to summarize which product lines are experiencing significant declines in revenue or margins, thus completing the assessment of financial performance.

Each sub-task is designed to be handled by a single specialized agent, allowing for parallel execution where possible. 

#### Local Constraints:
- **Task 1:** Must retrieve data from financial statements dated within the last two years.
- **Task 2:** Focus specifically on product line revenues, filtering for any that show declines.
- **Task 3:** Calculate margins based on the preceding revenue analysis from Task 2.
- **Task 4:** Summarize the findings logically based on the results from all previous tasks.

#### Global Constraints:
- All analyses must adhere to reporting standards and ensure that all financial data is accurate and up-to-date, ensuring compliance with applicable regulations.

### JSON Template Population

```json
{
    "main_task": "Evaluate the financial performance of BTG's key product lines in the last two years, highlighting any segments experiencing significant revenue decline or margin.",
    "sub_tasks": {
        "task_1": {
            "content": "Retrieve BTG's income statement, balance sheet, and cash flow statement for the last two years. This data forms the foundation for understanding the company's overall financial health.",
            "agent": "Financial Analyst",
            "agent_role_description": "The Financial Analyst is responsible for retrieving and analyzing financial statements to provide insights on the financial standings of the company.",
            "tools": ["get_income_stmt", "get_balance_sheet", "get_cash_flow"],
            "local_constraints": ["Data must be dated within the last two years."],
            "require_data": []
        },
        "task_2": {
            "content": "Based on the income statement retrieved in task_1, analyze the revenue for BTG's key product lines to identify any segments experiencing revenue decline over the last two years.",
            "agent": "Market Researcher",
            "agent_role_description": "The Market Researcher will analyze the data retrieved in task_1, focusing on revenue by product line and identifying any decline.",
            "tools": ["get_income_stmt"],
            "local_constraints": ["Focus on product line revenues and filter for declines."],
            "require_data": ["task_1"]
        },
        "task_3": {
            "content": "Based on the revenue analysis conducted in task_2, assess the margin trends for the identified product lines and calculate margins using revenue and cost data from the income statement.",
            "agent": "Financial Analyst",
            "agent_role_description": "The Financial Analyst will calculate and analyze margins for BTG's key product lines based on the revenue data provided in task_2.",
            "tools": ["get_income_stmt"],
            "local_constraints": ["Calculate margins based on revenue and costs identified in task_2."],
            "require_data": ["task_2"]
        },
        "task_4": {
            "content": "Compile results from tasks 2 and 3 to summarize and identify key findings on revenue declines and margin performance for BTG's product lines.",
            "agent": "General Researcher",
            "agent_role_description": "The General Researcher will synthesize findings from previous analyses to report on significant trends in revenue and margins.",
            "tools": [],
            "local_constraints": ["Summarization must logically follow from the findings in tasks 2 and 3."],
            "require_data": ["task_2", "task_3"]
        }
    }
}
``` 

In this structured task breakdown, each sub-task is designed to build logically on the last, while still being manageable and specific enough to allow for effective parallel execution where possible.